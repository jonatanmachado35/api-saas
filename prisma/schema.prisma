generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  USER
  MODERATOR
  ADMIN
  OWNER
}

enum Plan {
  FREE
  PRO
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PENDING
}

enum Sender {
  USER
  AGENT
}

enum AgentVisibility {
  PRIVATE
  PUBLIC
  PRO_ONLY
  CUSTOM_ONLY
  ADMIN_ONLY
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String?
  google_id     String?   @unique
  github_id     String?   @unique
  full_name     String?
  avatar_url    String?
  role          Role      @default(USER)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  subscription  Subscription?
  agents        Agent[]
  chats         Chat[]
  payments      Payment[]

  @@map("users")
}

model Subscription {
  id         String             @id @default(uuid())
  user_id    String             @unique
  plan       Plan               @default(FREE)
  status     SubscriptionStatus @default(ACTIVE)
  credits    Int                @default(50)
  created_at DateTime           @default(now())
  updated_at DateTime           @updatedAt

  user       User               @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Agent {
  id          String           @id @default(uuid())
  user_id     String
  llm_id      String?
  name        String
  avatar      String?
  description String?
  prompt      String?
  category    String?
  type        String?
  tone        String?
  style       String?
  focus       String?
  rules       String?
  visibility  AgentVisibility  @default(PRIVATE)
  created_at  DateTime         @default(now())
  updated_at  DateTime         @updatedAt

  user        User             @relation(fields: [user_id], references: [id], onDelete: Cascade)
  llm         Llm?             @relation(fields: [llm_id], references: [id], onDelete: SetNull)
  chats       Chat[]

  @@map("agents")
}

model Llm {
  id         String   @id @default(uuid())
  name       String
  provider   String
  model      String
  max_tokens Int
  credit_cost Int     @default(1)
  active     Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  agents     Agent[]

  @@map("llms")
}

model Chat {
  id            String    @id @default(uuid())
  user_id       String
  agent_id      String
  title         String?
  unread        Boolean   @default(false)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  user          User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  agent         Agent     @relation(fields: [agent_id], references: [id], onDelete: Cascade)
  messages      Message[]

  @@map("chats")
}

model Message {
  id         String   @id @default(uuid())
  chat_id    String
  content    String
  sender     Sender
  timestamp  DateTime @default(now())

  chat       Chat     @relation(fields: [chat_id], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Contact {
  id         String   @id @default(uuid())
  name       String
  email      String
  company    String?
  subject    String
  message    String
  created_at DateTime @default(now())

  @@map("contacts")
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  CANCELED
  REFUNDED
}

enum PaymentType {
  SUBSCRIPTION
  CREDITS
}

enum PaymentFrequency {
  ONE_TIME
  MONTHLY
}

enum ProductType {
  SUBSCRIPTION
  CREDITS
}

model Payment {
  id          String           @id @default(uuid())
  user_id     String
  type        PaymentType
  amount      Int
  description String
  status      PaymentStatus    @default(PENDING)
  frequency   PaymentFrequency @default(ONE_TIME)
  external_id String?          @unique
  payment_url String?
  metadata    Json?
  created_at  DateTime         @default(now())
  updated_at  DateTime         @updatedAt

  user        User             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("payments")
}

model Product {
  id          String      @id @default(uuid())
  type        ProductType
  slug        String      @unique
  name        String
  description String?
  price       Int
  credits     Int?
  bonus       Int?
  active      Boolean     @default(true)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  @@map("products")
}
